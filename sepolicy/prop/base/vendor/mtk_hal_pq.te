# ==============================================
# MTK Policy Rule
# ==============================================
# Policy File of /vendor/bin/hw/vendor.mediatek.hardware.pq@2.0-service Executable File

type mtk_hal_pq, domain;
type mtk_hal_pq_exec, exec_type, file_type, vendor_file_type;

init_daemon_domain(mtk_hal_pq)

binder_use(mtk_hal_pq)

hal_server_domain(mtk_hal_pq, hal_mtk_pq)

# Allow to allocate hidl memory
hal_client_domain(mtk_hal_pq, hal_allocator)

# Purpose: Allow to use kernel driver
allow mtk_hal_pq graphics_device:chr_file rw_file_perms;

# Purpose: Allow permission to get AmbientLux from hwservice_manager
allow mtk_hal_pq fwk_sensor_hwservice:hwservice_manager find;

# Purpose: Allow permission to set pq property
set_prop(mtk_hal_pq, vendor_mtk_pq_prop)

# Purpose: Allow permission to get pq property
get_prop(mtk_hal_pq, vendor_mtk_pq_ro_prop)

allow mtk_hal_pq gpu_device:dir search;
allow mtk_hal_pq dri_device:chr_file rw_file_perms;
allow mtk_hal_pq mml_pq_device:chr_file rw_file_perms;

# Purpose: Allow permission to get MMAgent from hwservice_manager
hal_client_domain(mtk_hal_pq, hal_mtk_mmagent)

# Purpose: Allow permission to access composer_ext service(AIDL)
hal_client_domain(mtk_hal_pq, hal_mtk_composer_ext)

# Purpose: Allow permission to use DMABuffer
allow mtk_hal_pq dmabuf_system_heap_device:chr_file r_file_perms;

# Date: WK17.01
# Operation: New feature: Factory Gamma
# Purpose: Allow nvram access
allow mtk_hal_pq nvdata_file:dir w_dir_perms;
allow mtk_hal_pq nvdata_file:file create_file_perms;
allow mtk_hal_pq nvdata_file:lnk_file read;
allow mtk_hal_pq nvram_data_file:dir w_dir_perms;
allow mtk_hal_pq nvram_data_file:file create_file_perms;
allow mtk_hal_pq nvram_data_file:lnk_file read;

# Purpose: Allow access to data/vendor/pq
allow mtk_hal_pq mtk_disp_pq_data_file:dir create_dir_perms;
allow mtk_hal_pq mtk_disp_pq_data_file:file create_file_perms;

# Operation: New feature: AppGamePQ 2.0
# Purpose: create hidl handle for buffer
allow mtk_hal_pq hal_graphics_allocator_default:fd use;
allow mtk_hal_pq proc_ged:file r_file_perms;
allowxperm mtk_hal_pq proc_ged:file ioctl proc_ged_ioctls;

# Purpose : Allow change priority
allow mtk_hal_pq self:capability sys_nice;

# Purpose : Allow get brightness
allow mtk_hal_pq sysfs_leds:dir r_dir_perms;
allow mtk_hal_pq sysfs_leds:file r_file_perms;

hal_client_domain(mtk_hal_pq, hal_graphics_allocator)

# Purpose : Allow to use binder
binder_use(mtk_hal_pq)
