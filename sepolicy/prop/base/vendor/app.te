# ==============================================
# MTK Policy Rule
# ==============================================

# Date : 2016/07/11
# Operation: Migration
# Purpose: Add permission for gpu access
allow appdomain dri_device:chr_file rw_file_perms;

# allow mtk_sec_video_path_support
get_prop(appdomain, vendor_mtk_sec_video_path_support_prop)

# allow mtk_mtee_on_svp_support
get_prop(appdomain, vendor_mtk_svp_on_mtee_support_prop)

# Date : WK16.33
# Purpose: Allow to access ged for gralloc_extra functions
allow appdomain proc_ged:file rw_file_perms;
allowxperm appdomain proc_ged:file ioctl { proc_ged_ioctls };

# Data : WK16.42
# Operator: Whitney bring up
# Purpose: call surfaceflinger due to powervr
allow appdomain surfaceflinger:fifo_file rw_file_perms;

# Date : W16.42
# Operation : Integration
# Purpose : DRM / DRI GPU driver required
allow appdomain gpu_device:dir search;

# Date : W17.41
# Operation: SQC
# Purpose : Allow HWUI to access perfmgr
allow appdomain proc_perfmgr:dir search;
allow appdomain proc_perfmgr:file r_file_perms;
allowxperm appdomain proc_perfmgr:file ioctl {
  PERFMGR_FPSGO_QUEUE
  PERFMGR_FPSGO_DEQUEUE
  PERFMGR_FPSGO_QUEUE_CONNECT
  PERFMGR_FPSGO_BQID
  PERFMGR_FPSGO_SWAP_BUFFER
  PERFMGR_FPSGO_SBE_RESCUE
  PERFMGR_FPSGO_BUFFER_QUOTA
  PERFMGR_FPSGO_ACQUIRE
  PERFMGR_FPSGO_SBE_SET_POLICY
  PERFMGR_FPSGO_HINT_FRAME
};

# Date : W20.26
# Operation : Migration
# Purpose : For apps other than isolated_app_all call hidl
hwbinder_use({ appdomain -isolated_app_all })
get_prop({ appdomain -isolated_app_all }, hwservicemanager_prop)
allow { appdomain -isolated_app_all } hidl_manager_hwservice:hwservice_manager find;
binder_call({ appdomain -isolated_app_all }, mtk_safe_halserverdomain_type)
allow { appdomain -isolated_app_all } mtk_safe_hwservice_manager_type:hwservice_manager find;

# Date: 2022/06/17
# Purpose :allow appdomain to get vendor_mtk_magt_support_prop
get_prop(appdomain, vendor_mtk_magt_support_prop)
get_prop(appdomain, vendor_mtk_magt_app_support_prop)

# Date: 2022/11/02
# Purpose :allow appdomain to get vendor_mtk_soc_prop
get_prop(appdomain, vendor_mtk_soc_prop)

# Data: 2023/03/22
# Purpose :allow appdomain to use mtk safe aidl
allow { appdomain -isolated_app_all } mtk_safe_service_manager_type:service_manager find;
binder_call(appdomain, mtk_safe_service_manager_type)
